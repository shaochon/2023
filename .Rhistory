geom_point(aes(x = month, y = expected), col='blue') +
geom_errorbar(aes(ymin = expected - 1.96*se, ymax = expected + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
dat |>
group_by(month) |>
summarize(se = sd(deaths)/sqrt(n()),
expected = mean(deaths)) |>
filter(month %in% c(9,10))
dat |>
group_by(month) |>
summarize(se = sd(deaths)/sqrt(n())) |>
filter(month %in% c(9,10))
dat |>
group_by(month) |>
summarize(se = sd(deaths)/sqrt(n()))
#| warning: false
#| message: false
library(readr)
library(dplyr)
library(forcats)
library(lubridate)
library(tidyr)
library(stringr)
library(pdftools)
library(janitor)
library(httr2)
library(excessmort)
library(jsonlite)
library(purrr)
#| warning: false
#| message: false
library(ggthemes)
# library(ThemePark)
library(ggrepel)
filename <- "data/santoslozada-howard-2017-preprint.pdf"
txt <- pdf_text(filename)[4]
tmp <- str_split(txt, "\n")[[1]][2:14] |>
str_replace_all("\\s([A-Z])", "\\1") %>%
str_replace("\\s-\\s", "-") %>%
str_split("\\s+", simplify = TRUE)
tmp[1,1] <- "month"
dat <- tmp |>
row_to_names(1) |>
as.data.frame() |>
select(month, `2010`:`2016`) |>
pivot_longer(-month, names_to = "year", values_to = "deaths") |>
mutate(month = match(month, month.name),
year = factor(year), deaths = parse_number(deaths))
p <- dat |>
group_by(month) |>
summarize(mean = mean(deaths),
se = sd(deaths)/sqrt(n()),
lower = mean - qt(0.975,n()-1)*se,
upper = mean + qt(0.975,n()-1)*se) |>
ggplot(aes(x = month, y = mean)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = lower, ymax = upper)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Mean and 95% CI",
title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016') +
theme_bw()
p
dat |>
group_by(month) |>
summarize(se = sd(deaths)/sqrt(n()))
dat |>
group_by(month) |>
summarize(mean = mean(deaths),
se = sd(deaths)/sqrt(n()),
lower = mean - qt(0.975,n()-1)*se,
upper = mean + qt(0.975,n()-1)*se)
p <- dat |>
group_by(month) |>
summarize(mean = mean(deaths),
se = sd(deaths)/sqrt(n()),
lower = mean - qt(0.975,n()-1)*se,
upper = mean + qt(0.975,n()-1)*se)
p |>
ggplot(aes(x = month, y = mean)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = lower, ymax = upper)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Mean and 95% CI",
title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016') +
theme_bw()
dat2010_2016_se_expected <- dat |>
group_by(month) |>
summarize(se = sd(deaths)/sqrt(n()),
expected = mean(deaths)) |>
filter(month %in% c(9,10))
dat_2017 <- data.frame(month = c(9,10), deaths = c(2987, 3043))
dat_2017 <- dat_2017 |>
left_join(p, by = "month")
dat_2017
dat2010_2016_se_expected <- dat |>
group_by(month) |>
summarize(se = sd(deaths)/sqrt(n()),
expected = mean(deaths)) |>
filter(month %in% c(9,10))
dat_2017 <- data.frame(month = c(9,10), deaths = c(2987, 3043))
dat_2017 <- dat_2017 |>
left_join(p |> select(month, sd), by = "month")
p |> select(month, sd)
dat2010_2016_se_expected <- dat |>
group_by(month) |>
summarize(se = sd(deaths)/sqrt(n()),
expected = mean(deaths)) |>
filter(month %in% c(9,10))
dat_2017 <- data.frame(month = c(9,10), deaths = c(2987, 3043))
dat_2017 <- dat_2017 |>
left_join(p |> select(month, se), by = "month")
dat_2017
dat_2017 |>
ggplot(aes(x = month, y = deaths)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
geom_point(aes(x = month, y = expected), col='blue') +
geom_errorbar(aes(ymin = expected - 1.96*se, ymax = expected + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
dat_2017 <- data.frame(month = c(9,10), deaths = c(2987, 3043)) |>
left_join(p |> select(month, se), by = "month")
dat_2017
dat_2017 |>
ggplot(aes(x = month, y = deaths)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
geom_point(data = dat, aes(x = month, y = expected), col='blue') +
geom_errorbar(aes(ymin = expected - 1.96*se, ymax = expected + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
dat
dat_2017 |>
ggplot(aes(x = month, y = deaths)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
geom_point(data = dat |> filter(year==2017), aes(x = month, y = deaths), col='blue') +
geom_errorbar(aes(ymin = expected - 1.96*se, ymax = expected + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
dat_2017 |>
ggplot(aes(x = month, y = deaths)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
geom_point(data = dat |> filter(year==2017), aes(x = month, y = deaths), col='blue') +
geom_errorbar(ata = dat |> filter(year==2017), aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p + dat_2017 |>
ggplot(aes(x = month, y = deaths)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
geom_point(aes(x = month, y = deaths), col='blue') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p +
geom_point(dat = dat_2017,aes(x = month, y = deaths), col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
geom_point(aes(x = month, y = deaths), col='blue') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p +  geom_point(dat = dat_2017,aes(x = month, y = deaths), col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p +  geom_point(dat = dat_2017,aes(x = month, y = deaths), col='red')
dat_2017
p +  geom_point(data = dat_2017,aes(x = month, y = deaths), col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p +  geom_point(data = dat_2017,aes(x = month, y = deaths), col='red')
p +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p +  geom_point(data = dat_2017,aes(x = month, y = deaths))
p
p <- dat |>
group_by(month) |>
summarize(mean = mean(deaths),
se = sd(deaths)/sqrt(n()),
lower = mean - qt(0.975,n()-1)*se,
upper = mean + qt(0.975,n()-1)*se)
p1 <- p |>
ggplot(aes(x = month, y = mean)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = lower, ymax = upper)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Mean and 95% CI",
title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016') +
theme_bw()
p1
p1 +
ggplot(dat = dat_2017,aes(x = month, y = deaths)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
geom_point(aes(x = month, y = deaths), col='blue') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths))
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
p <- dat |>
group_by(month) |>
summarize(mean = mean(deaths),
se = sd(deaths)/sqrt(n()),
lower = mean - qt(0.975,n()-1)*se,
upper = mean + qt(0.975,n()-1)*se)
p1 <- p |>
ggplot(aes(x = month, y = mean)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = lower, ymax = upper)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Mean and 95% CI",
title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016') +
theme_bw()
p1
p +
ggplot(dat = dat_2017,aes(x = month, y = deaths)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
geom_point(aes(x = month, y = deaths), col='blue') +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
p <- dat |>
group_by(month) |>
summarize(mean = mean(deaths),
se = sd(deaths)/sqrt(n()),
lower = mean - qt(0.975,n()-1)*se,
upper = mean + qt(0.975,n()-1)*se)
p1 <- p |>
ggplot(aes(x = month, y = mean)) +
geom_point(col='red') +
geom_errorbar(aes(ymin = lower, ymax = upper)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Mean and 95% CI",
title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016') +
theme_bw()
p1
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
p1 +
）
啪
p1
p <- dat |>
group_by(month) |>
summarize(mean = mean(deaths),
se = sd(deaths)/sqrt(n()),
lower = mean - qt(0.975,n()-1)*se,
upper = mean + qt(0.975,n()-1)*se)
p1 <- ggplot(data = p, aes(x = month, y = mean)) +
geom_point(col='red') +
geom_errorbar(data = p, aes(ymin = lower, ymax = upper)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Mean and 95% CI",
title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016') +
theme_bw()
p1
p <- dat |>
group_by(month) |>
summarize(mean = mean(deaths),
se = sd(deaths)/sqrt(n()),
lower = mean - qt(0.975,n()-1)*se,
upper = mean + qt(0.975,n()-1)*se)
p1 <- ggplot(data = p, aes(x = month, y = mean)) +
geom_point(col='red') +
geom_errorbar(data = p, aes(ymin = lower, ymax = upper)) +
scale_x_continuous(breaks = 1:12, labels = month.abb) +
labs(x = "Month", y = "Mean and 95% CI",
title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016') +
theme_bw()
p1
p1 +  geom_point(data = dat_2017,aes(x = month, y = deaths)) +
geom_errorbar(data = dat_2017, aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
dat_2017 |>
right_join(p, by = "month") |>
ggplot(aes(x = month, y = deaths)) +
geom_point() +
geom_errorbar(data = dat_2017, aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
dat_2017 |>
right_join(p, by = "month")
dat_2017 |>
right_join(p, by = "month") |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
dat_2017 |>
right_join(p, by = "month") |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se, ymax = deaths + 1.96*se))
dat_2017 |>
right_join(p, by = "month") |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x))
dat_2017 |>
right_join(p, by = "month") |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='blue') +
geom_errorbar(aes(x= month, ymin = mean - 1.96*se.y, ymax = mean + 1.96*se.y))
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='blue') +
geom_errorbar(aes(x= month, ymin = mean - 1.96*se.y, ymax = mean + 1.96*se.y))
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='blue') +
geom_errorbar(aes(x= month, ymin = mean - 1.96*se.y, ymax = mean + 1.96*se.y))  +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
dat_2017 |>
right_join(p, by = "month")
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='blue') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Deaths in Puerto Rico, 2017')
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016 + 2017 Sep and Oct') +
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Average deaths and 95% confidence intervals by month in Puerto Rico, 2010-2016 + 2017 Sep and Oct')
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Average deaths and 95% CI by month in Puerto Rico, 2010-2016 + 2017 Sep and Oct')
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Average deaths and 95% CI, 2010-2016 + 2017 Sep and Oct')
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Average deaths and 95% CI, 2010-2016 + 2017 Sep and Oct in PR')
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Average deaths and 95% CI, 2010-2016 + 2017 Sep and Oct in Puerto Rico')
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Average deaths and 95% CI, 2010-2016 + 2017 Sep and Oct in Puerto Rico')
#| warning: false
dat_2017 |>
right_join(p, by = "month") |>
mutate(month = as.factor(month)) |>
ggplot() +
geom_point(aes(x = month, y = deaths)) +
geom_errorbar(aes(x= month, ymin = deaths - 1.96*se.x, ymax = deaths + 1.96*se.x)) +
geom_point(aes(x = month, y = mean), col='red') +
geom_errorbar(aes(x= month, ymin = lower, ymax = upper))  +
labs(x = "Month", y = "Deaths",title = 'Average deaths and 95% CI, 2010-2016 + 2017 Sep and Oct in Puerto Rico') +
theme_bw()
all <- weekly_counts |>
group_by(year, mmwr_week) |>
summarize(outcome = sum(outcome),.groups = 'drop') |>
mutate(if_2017 = if_else(year==2017,1,0))
all |> filter(if_2017==0) |>
ggplot(aes(x = mmwr_week, y = outcome, group=mmwr_week)) +
geom_boxplot() +
geom_point(data = all |> filter(if_2017==1), aes(x = mmwr_week, y = outcome), col='red') +
labs(x = "MMWR week", y = "Deaths per week",title='Death by MMWR week in Puerto Rico, 2002-2017') +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
geom_vline(xintercept = 38, col = 'blue', linetype = 'dashed')
excess <- res|>
group_by(t) |>
summarize(exp=sum(population*exp),
obs=sum(population*rate),
sd=sqrt(sum(population^2*sd^2))) |>
mutate(diff = obs - exp) #weekly excess
sd<-unique(excess$sd)
excess|>ggplot(aes(t,diff)) +
geom_point() +
geom_hline(yintercept = 0, lty=2) +
geom_hline(yintercept = c(-2,2)*sd, lty=2, color="red") +
labs(title = "Weekly Excess Deaths for 2017",x ="Week Since 2002",y ="Excess Deaths") +
excess <- res|>
group_by(t) |>
summarize(exp=sum(population*exp),
obs=sum(population*rate),
sd=sqrt(sum(population^2*sd^2))) |>
mutate(diff = obs - exp) #weekly excess
sd<-unique(excess$sd)
excess|>ggplot(aes(t,diff)) +
geom_point() +
geom_hline(yintercept = 0, lty=2) +
geom_hline(yintercept = c(-2,2)*sd, lty=2, color="red") +
labs(title = "Weekly Excess Deaths for 2017",x ="Week Since 2002",y ="Excess Deaths")
excess|>
mutate(excess=cumsum(diff),sd=sqrt(cumsum(sd^2)))|>
ggplot(aes(x = t, y = excess)) +
geom_ribbon(aes(ymin = excess - 1.96*sd, ymax = excess + 1.96*sd), alpha = 0.5) +
geom_line()+
geom_hline(yintercept = 0, lty=2) +
labs(title = "Cumulatyve Weekly Excess Deaths for 2017",x ="Week",y ="Cumulative excess Deaths") +
theme_bw()
excess|>
mutate(excess=cumsum(diff),sd=sqrt(cumsum(sd^2)))|>
ggplot(aes(x = t, y = excess)) +
geom_ribbon(aes(ymin = excess - 1.96*sd, ymax = excess + 1.96*sd), alpha = 0.5) +
geom_line()+
geom_hline(yintercept = 0, lty=2) +
labs(title = "Cumulative Weekly Excess Deaths for 2017",x ="Week",y ="Cumulative excess Deaths") +
theme_bw()
